(()=>{"use strict";const t=["Camry","Cayenne","Combi","7","9","Corsa","M8","A4","Jetta","Model S"],e=["Tesla","BMW","Mersedes","Ford","Zhiguli","Moskvich","Toyota","Porsche","Volkswagen","Lada"],n="0123456789ABCDEF",a=()=>{let t="#";for(let e=0;e<6;e++)t+=n[Math.floor(Math.random()*n.length)];return t};function s(t){const e=t.getBoundingClientRect();return{x:e.left+e.width/2,y:e.top+e.height/2}}const i="http://127.0.0.1:3000",r=new class{constructor(){this._cars=[],this.count=0,this.carsPage=1,this.selectedCarId="",this.car={id:0,name:"",color:""},this.animation={0:{id:0}}}async fetchCars(t,e=7){const n=await fetch(`${i}/garage?_page=${t}&_limit=${e}`),a=await n.json(),s=Number(n.headers.get("X-Total-Count"));this._cars=a,this.count=s}async deleteCar(t){const e=await fetch(`${i}/garage/${t}`,{method:"DELETE"});return await e.json()}getCars(){return this._cars}getCount(){return this.count}async getCar(t){const e=await fetch(`${i}/garage/${t}`),n=await e.json();return this.car=n,this.car}async createCar(t){const e=await fetch(`${i}/garage`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),n=await e.json();return this.car=n,this.car}async updateCar(t,e){const n=await fetch(`${i}/garage/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),a=await n.json();return this.car=a,this.car}async updateGarage(t){await this.fetchCars(t),7*t<this.count?document.getElementById("next-btn").disabled=!1:document.getElementById("next-btn").disabled=!0,document.getElementById("prev-btn").disabled=!(t>1)}async selectCar(t){if(t.target.classList.contains("select-button")){this.selectedCarId=t.target.id.split("-")[2];const e=await this.getCar(+this.selectedCarId);document.getElementById("update-name").value=e.name,document.getElementById("update-color").value=e.color,document.getElementById("update-name").disabled=!1,document.getElementById("update-color").disabled=!1,document.getElementById("update-submit").disabled=!1}}async startEngine(t){const e=await fetch(`${i}/engine?id=${t}&status=started`,{method:"PATCH"});return await e.json()}async stopEngine(t){const e=await fetch(`${i}/engine?id=${t}&status=stopped`,{method:"PATCH"});return await e.json()}async driveCar(t){const e=await fetch(`${i}/engine?id=${t}&status=drive`,{method:"PATCH"}).catch();return 200!==e.status?{success:!1}:Object.assign({},await e.json())}async startDriving(t){const e=document.getElementById(`start-car-${t}`);e.disabled=!0;const{velocity:n,distance:a}=await this.startEngine(t);e.classList.toggle("enabling",!1);const i=Math.round(a/n),r=document.getElementById(`stop-car-${t}`);r.disabled=!1,r.classList.toggle("enabling",!0);const c=document.getElementById(`car-${t}`),d=document.getElementById(`flag-${t}`),o=Math.floor(function(t,e){const n=s(t),a=s(e),i=Math.pow(n.x-a.x,2)+Math.pow(n.y-a.y,2);return Math.sqrt(i)}(c,d))+80;this.animation[t]=function(t,e,n){let a=null;const s={id:1};return s.id=window.requestAnimationFrame((function i(r){a||(a=r);const c=r-a,d=Math.round(c*(e/n));t.style.transform=`translateX(${Math.min(d,e)}px)`,d<e&&(s.id=window.requestAnimationFrame(i))})),s}(c,o,i);const{success:g}=await this.driveCar(t);return g||window.cancelAnimationFrame(this.animation[t].id),{success:g,id:t,time:i}}async stopDriving(t){const e=document.getElementById(`stop-car-${t}`);e.disabled=!0,e.classList.toggle("enabling",!0),await this.stopEngine(t),e.classList.toggle("enabling",!1);const n=document.getElementById(`start-car-${t}`);n.disabled=!1,n.classList.toggle("enabling",!0),document.getElementById(`car-${t}`).style.transform="translateX(0)",this.animation[t]&&window.cancelAnimationFrame(this.animation[t].id)}async raceAll(t,e){const{success:n,id:a,time:s}=await Promise.race(t);if(!n){const n=e.findIndex((t=>t===a)),s=[...t.slice(0,n),...t.slice(n+1,t.length)],i=[...e.slice(0,n),...e.slice(n+1,e.length)];return this.raceAll(s,i)}const i=this._cars.filter((t=>t.id===a))[0];return Object.assign(Object.assign({},i),{time:+(s/1e3).toFixed(2)})}async race(t){const e=this._cars.map((({id:e})=>t(e)));return await this.raceAll(e,this._cars.map((t=>t.id)))}},c=new class{constructor(){this.winners=[],this.count=0,this.winner={id:0,wins:0,time:0},this.winnersPage=1,this.sortBy=null,this.sortOrder=null}async getCar(t){const e=await fetch(`http://127.0.0.1:3000/garage/${t}`);return await e.json()}getSortOrder(t,e){return t&&e?`&_sort=${t}&_order=${e}`:""}async fetchWinners({page:t,limit:e=10,sort:n,order:a}){const s=await fetch(`http://127.0.0.1:3000/winners?_page=${t}&_limit=${e}${this.getSortOrder(n,a)}`),i=await s.json(),r=await Promise.all(i.map((async t=>Object.assign(Object.assign({},t),{car:await this.getCar(t.id)})))),c=Number(s.headers.get("X-Total-Count"));this.winners=r,this.count=c}getWinners(){return this.winners}getCount(){return this.count}async getWinner(t){const e=await fetch(`http://127.0.0.1:3000/winners/${t}`),n=await e.json();return this.winner=n,this.winner}async getWinnerStatus(t){return(await fetch(`http://127.0.0.1:3000/winners/${t}`)).status}async createWinner(t){const e=await fetch("http://127.0.0.1:3000/winners",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return await e.json()}async deleteWinner(t){const e=await fetch(`http://127.0.0.1:3000/winners/${t}`,{method:"DELETE"});return await e.json()}async updateWinner(t,e){const n=await fetch(`http://127.0.0.1:3000/winners/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),a=await n.json();return this.winner=a,this.winner}async saveWinners({id:t,time:e}){if(404===await this.getWinnerStatus(t))await this.createWinner({id:t,wins:1,time:e});else{const n=await this.getWinner(t);await this.updateWinner(t,{id:t,wins:n.wins+1,time:e<n.time?e:n.time})}}async updateWinners(){await this.fetchWinners({page:this.winnersPage,sort:this.sortBy,order:this.sortOrder}),10*this.winnersPage<this.count?document.getElementById("next-btn").disabled=!1:document.getElementById("next-btn").disabled=!0,this.winnersPage>1?document.getElementById("prev-btn").disabled=!1:document.getElementById("prev-btn").disabled=!0}async setSortOrder(t){this.sortOrder="asc"===this.sortOrder?"desc":"asc",this.sortBy=t,await this.updateWinners()}},d=new class{constructor(t,e){this.garage=t,this.winners=e}render(t,e,n){const a=`\n    <header>\n      <nav class="menu">\n        <button class="button garage-menu-button" id="garage-menu">To garage</button>\n        <button class="button winners-menu-button" id="winners-menu">To winners</button>\n      </nav>\n    </header>\n    <div class="" id="garage-view">\n      <form class="form" id="create-form">\n        <input class="input" id="create-name" name="name" type="text">\n        <input class="color" id="create-color" name="color" type="color" value="#ffffff">\n        <button class="button" type="submit">Create</button>\n      </form>\n      <form class="form" id="update-form">\n        <input class="input" id="update-name" name="name" type="text" disabled>\n        <input class="color" id="update-color" name="color" type="color" value="#ffffff" disabled>\n        <button class="button" type="submit" id="update-submit" disabled>Update</button>\n      </form>\n      <div class="controls">\n        <button class="button race-button" id="race">Race</button>\n        <button class="button reset-button" id="reset" disabled>Reset</button>\n        <button class="button generate-button" id="generate">Generate cars</button>\n      </div>\n      <div id="garage">\n        ${this.renderGarage(t,n)}\n      </div>\n      <div>\n        <p class="message hide" id="message"></p>\n      </div>\n    </div>\n    <div id="winners-view" class="hide">\n        ${this.renderWinners(e)}\n    </div>\n    <div class="pagination">\n        <button class="button" id="prev-btn" disabled>Prev</button>\n        <button class="button" id="next-btn" disabled>Next</button>\n    </div>\n    `,s=document.createElement("div");s.innerHTML=a,document.body.appendChild(s)}renderGarage(t,e){return`\n    <h1>Garage (${this.garage.getCount()})</h1>\n    <h2>Page #${e}</h2>\n    <ul class="garage">\n      ${t.map((t=>`<li>${this.renderCar(t)}</li>`)).join("")}\n    </ul>`}renderWinners(t){return`\n   <h1>Winners (${this.winners.getCount()})</h1>\n   <h2>Page #${this.winners.winnersPage}</h2>\n   <table>\n    <thead>\n      <tr>\n        <th>Number</th>\n        <th>Car</th>\n        <th>Name</th>\n        <th class="table-button table-wins ${"wins"===this.winners.sortBy?this.winners.sortOrder:""}" id="sort-by-wins">Wins</th>\n        <th class="table-button table-time ${"time"===this.winners.sortBy?this.winners.sortOrder:""}" id="sort-by-time">Best time (sec)</th>\n      </tr>\n    </thead>\n    <tbody>\n        ${t.map(((t,e)=>`\n        <tr>\n          <td>${e+1}</td>\n          <td>${this.renderCarImage(t.car.color)}</td>\n          <td>${t.car.name}</td>\n          <td>${t.wins}</td>\n          <td>${t.time}</td>\n        </tr>\n        `)).join("")}\n    </tbody>\n    </table>`}listen(){document.addEventListener("click",(async t=>{if(t.target.classList.contains("start-engine-button")){const e=t.target.id.split("-")[2];this.garage.startDriving(+e)}if(t.target.classList.contains("stop-engine-button")){const e=t.target.id.split("-")[2];this.garage.stopDriving(+e)}t.target.classList.contains("race-button")&&await this.garage.race(this.garage.startDriving)}))}renderCarButton(t){const e=document.createElement("div");e.classList.add("car-buttons");const n=document.createElement("button");n.classList.add("button","select-button"),n.setAttribute("id",`select-car-${t.id}`),n.textContent="Select";const a=document.createElement("button");a.classList.add("button","remove-button"),a.setAttribute("id",`remove-car-${t.id}`),a.textContent="Remove";const s=document.createElement("span");return s.classList.add("car-name"),s.textContent=`${t.name}`,e.appendChild(n),e.appendChild(a),e.appendChild(s),e.addEventListener("click",(async t=>this.garage.selectCar(t))),e}renderCar(t){return`\n    <div class="car-buttons">\n      <button class="button select-button" id="select-car-${t.id}">Select</button>\n      <button class="button remove-button" id="remove-car-${t.id}">Remove</button>\n      <span class="car-name">${t.name}</span>\n    </div>\n    <div class="road">\n      <div class="car-wrapper">\n        <div class="control-panel">\n          <button class="icon start-engine-button enabling" id="start-car-${t.id}">A</button>\n          <button class="icon stop-engine-button" id="stop-car-${t.id}" disabled>B</button>\n        </div>\n        <div class="car" id="car-${t.id}">\n          ${this.renderCarImage(t.color)}\n        </div>\n      </div>\n      <div class="flag" id="flag-${t.id}">&#9873;</div>\n    </div>`}renderCarImage(t){return`\n<?xml version="1.0" standalone="no"?>\n<svg version="1.0" xmlns="http://www.w3.org/2000/svg"\n width="100" height="50" viewBox="0 0 1280.000000 640.000000"\n preserveAspectRatio="xMidYMid meet">\n<g transform="translate(0.000000,640.000000) scale(0.100000,-0.100000)"\nfill="${t}" stroke="none">\n<path d="M3565 5336 c-106 -30 -101 -26 -108 -111 -4 -42 -9 -80 -12 -85 -6\n-10 -246 -105 -590 -234 -448 -167 -1052 -415 -1173 -483 -78 -43 -193 -91\n-250 -104 -23 -5 -98 -14 -165 -19 -67 -6 -167 -19 -222 -30 -154 -31 -340\n-49 -563 -57 l-203 -6 -43 -66 c-59 -91 -60 -95 -26 -130 37 -37 38 -65 3\n-150 -25 -62 -27 -78 -31 -256 l-4 -190 -38 -32 c-91 -78 -133 -209 -134 -418\n0 -194 11 -396 26 -482 13 -71 14 -74 72 -122 69 -58 130 -129 158 -184 64\n-126 534 -211 1384 -250 l92 -4 -6 119 c-6 142 8 256 49 383 112 352 394 622\n756 722 90 26 112 28 278 28 165 0 188 -2 278 -27 201 -56 361 -152 504 -302\n140 -145 222 -293 274 -492 21 -79 24 -109 23 -279 -1 -127 -6 -214 -16 -263\nl-15 -73 3006 7 c1653 4 3007 8 3009 9 1 1 -8 37 -20 81 -19 67 -22 105 -22\n259 -1 166 1 187 27 279 117 421 467 736 885 797 119 17 325 7 432 -21 239\n-63 453 -205 601 -399 70 -92 154 -267 185 -386 24 -88 27 -119 27 -260 1\n-116 -4 -181 -16 -234 -10 -41 -16 -75 -15 -76 2 -1 62 2 133 6 266 16 458 45\n525 79 48 24 97 81 127 146 l24 52 -16 157 c-15 152 -15 163 4 284 63 388 50\n680 -35 802 -134 193 -526 336 -1429 519 -737 149 -1322 209 -2033 210 -228 0\n-226 0 -347 85 -187 131 -1045 607 -1471 815 -383 187 -788 281 -1439 332\n-208 17 -1106 16 -1400 0 -121 -7 -314 -19 -430 -27 -302 -22 -286 -22 -341\n10 -140 81 -187 94 -269 71z m1885 -333 c6 -37 38 -238 71 -446 32 -209 66\n-422 75 -474 9 -52 15 -96 13 -97 -11 -9 -1699 29 -1951 44 -206 13 -417 36\n-485 54 -98 26 -198 119 -249 231 -35 75 -36 172 -5 255 17 45 30 61 68 86 83\n54 135 80 253 127 341 136 858 230 1460 267 269 16 270 16 511 18 l227 2 12\n-67z m630 47 c264 -18 777 -110 1029 -186 186 -56 445 -188 756 -387 211 -134\n274 -181 250 -185 -75 -12 -133 -50 -162 -106 -19 -35 -21 -136 -4 -179 l11\n-27 -907 2 -906 3 -59 160 c-110 302 -298 878 -298 916 0 6 95 2 290 -11z"/>\n<path d="M2633 3125 c-223 -40 -410 -141 -568 -306 -132 -138 -213 -283 -262\n-467 -22 -83 -26 -119 -26 -247 -1 -169 10 -236 65 -382 87 -230 271 -436 493\n-551 85 -44 178 -78 271 -98 107 -23 312 -23 419 1 392 84 699 375 802 761 23\n86 26 120 27 254 1 158 -5 199 -46 330 -98 310 -355 567 -668 669 -150 50\n-354 64 -507 36z m350 -301 c249 -56 457 -247 543 -499 25 -72 28 -95 28 -220\n1 -153 -15 -228 -74 -345 -94 -186 -283 -337 -485 -386 -96 -24 -268 -24 -360\n0 -320 84 -544 355 -562 681 -20 359 209 673 558 765 94 24 253 26 352 4z"/>\n<path d="M2600 2697 c-36 -13 -85 -36 -109 -51 l-44 -28 116 -115 c81 -82 120\n-114 131 -110 14 6 16 29 16 167 0 186 6 178 -110 137z"/>\n<path d="M2920 2561 c0 -139 2 -162 16 -168 11 -4 50 28 130 108 l115 114 -28\n22 c-34 28 -138 70 -193 79 l-40 7 0 -162z"/>\n<path d="M2282 2448 c-28 -36 -92 -191 -92 -225 0 -10 34 -13 165 -13 151 0\n165 1 165 18 0 15 -206 232 -221 232 -4 0 -11 -6 -17 -12z"/>\n<path d="M3222 2351 c-62 -59 -112 -115 -112 -124 0 -15 17 -17 165 -17 131 0\n165 3 165 13 0 40 -69 205 -95 227 -7 6 -48 -27 -123 -99z"/>\n<path d="M2781 2332 c-12 -22 11 -62 34 -62 8 0 21 10 29 22 20 28 4 58 -29\n58 -13 0 -29 -8 -34 -18z"/>\n<path d="M2749 2161 c-32 -33 -37 -67 -14 -110 29 -57 104 -64 151 -14 53 57\n9 153 -71 153 -27 0 -44 -8 -66 -29z"/>\n<path d="M2570 2125 c-26 -32 13 -81 48 -59 24 16 27 45 6 61 -23 17 -39 16\n-54 -2z"/>\n<path d="M3006 2124 c-20 -19 -20 -38 -2 -54 23 -19 61 -8 64 18 7 44 -32 67\n-62 36z"/>\n<path d="M2190 1975 c0 -29 41 -140 72 -194 l31 -53 117 117 c71 71 116 123\n113 131 -4 11 -40 14 -169 14 -141 0 -164 -2 -164 -15z"/>\n<path d="M3110 1972 c0 -9 51 -68 114 -131 l114 -114 31 54 c30 51 71 165 71\n195 0 11 -31 14 -165 14 -151 0 -165 -1 -165 -18z"/>\n<path d="M2780 1901 c-7 -15 -5 -24 8 -41 32 -40 85 -4 62 41 -14 25 -56 25\n-70 0z"/>\n<path d="M2562 1697 c-61 -62 -112 -115 -112 -119 0 -18 208 -108 249 -108 7\n0 11 54 11 164 0 140 -2 165 -16 170 -9 3 -16 6 -17 6 -1 0 -53 -51 -115 -113z"/>\n<path d="M2933 1803 c-15 -6 -19 -333 -4 -333 46 0 251 88 251 108 0 9 -223\n232 -230 231 -3 0 -11 -3 -17 -6z"/>\n<path d="M10700 3119 c-390 -84 -696 -376 -797 -759 -31 -117 -41 -292 -24\n-411 33 -227 150 -453 318 -609 267 -250 643 -344 993 -249 117 32 283 118\n380 196 487 396 518 1128 67 1560 -97 93 -166 140 -290 198 -137 64 -235 86\n-407 91 -120 3 -162 0 -240 -17z m445 -313 c238 -81 409 -258 486 -506 30 -96\n33 -289 5 -388 -110 -400 -513 -637 -911 -536 -149 38 -313 147 -402 267 -176\n238 -203 533 -71 797 34 69 60 103 138 180 77 78 111 104 181 139 129 65 207\n81 364 77 109 -3 143 -7 210 -30z"/>\n<path d="M10703 2700 c-54 -19 -153 -71 -153 -80 0 -3 51 -57 114 -119 80 -80\n119 -112 130 -108 14 5 16 29 16 167 l0 160 -27 -1 c-16 0 -52 -9 -80 -19z"/>\n<path d="M11020 2561 c0 -139 2 -162 16 -168 22 -8 247 216 234 232 -17 20\n-163 84 -207 91 l-43 7 0 -162z"/>\n<path d="M10366 2424 c-29 -44 -76 -165 -76 -194 0 -19 7 -20 165 -20 126 0\n165 3 165 13 0 7 -51 63 -114 126 l-114 114 -26 -39z"/>\n<path d="M11313 2348 c-61 -62 -109 -119 -106 -125 6 -15 333 -19 333 -4 0 45\n-88 241 -108 241 -4 0 -57 -51 -119 -112z"/>\n<path d="M10882 2338 c-17 -17 -15 -32 7 -52 16 -14 23 -15 41 -6 31 17 24 64\n-10 68 -14 2 -31 -3 -38 -10z"/>\n<path d="M10846 2159 c-68 -81 17 -194 110 -144 89 48 56 175 -46 175 -30 0\n-44 -6 -64 -31z"/>\n<path d="M10670 2126 c-19 -23 -8 -61 18 -64 44 -7 67 32 36 62 -19 20 -38 20\n-54 2z"/>\n<path d="M11106 2127 c-21 -16 -18 -45 7 -61 37 -23 77 35 41 61 -10 7 -21 13\n-24 13 -3 0 -14 -6 -24 -13z"/>\n<path d="M10290 1970 c0 -29 43 -141 74 -195 l28 -48 116 116 c81 81 113 120\n109 131 -6 14 -29 16 -167 16 -152 0 -160 -1 -160 -20z"/>\n<path d="M11207 1978 c-3 -7 47 -66 111 -130 l116 -118 27 43 c27 44 79 177\n79 203 0 12 -28 14 -164 14 -122 0 -166 -3 -169 -12z"/>\n<path d="M10881 1901 c-14 -25 -5 -48 20 -56 27 -9 51 13 47 44 -4 34 -51 43\n-67 12z"/>\n<path d="M10662 1697 c-61 -62 -112 -115 -112 -119 0 -20 201 -108 247 -108\n10 0 13 34 13 164 0 140 -2 165 -16 170 -9 3 -16 6 -17 6 -1 0 -53 -51 -115\n-113z"/>\n<path d="M11033 1803 c-10 -3 -13 -47 -13 -169 0 -90 4 -164 8 -164 36 0 186\n61 239 98 16 10 -216 242 -234 235z"/>\n</g>\n</svg>`}}(r,c),o=new class{constructor(t,e,n){this.page=1,this.garage=t,this.winners=e,this.view=n,this.viewName="garage"}async start(){await this.garage.fetchCars(1);const t=this.garage.getCars();await this.winners.fetchWinners({page:1});const e=this.winners.getWinners();this.view.render(t,e,1),this.listen()}listen(){const n=document.getElementById("create-form");n.addEventListener("submit",(async t=>{t.preventDefault();const e=n.elements[0].value,a=n.elements[1].value;await this.garage.createCar({name:e,color:a}),await this.garage.updateGarage(this.garage.carsPage),document.getElementById("garage").innerHTML=this.view.renderGarage(this.garage._cars,this.page),document.getElementById("create-name").value="",document.getElementById("create-color").value="#ffffff"}));const s=document.getElementById("update-form");s.addEventListener("submit",(async t=>{t.preventDefault();const e=s.elements[0].value,n=s.elements[1].value;await this.garage.updateCar(+this.garage.selectedCarId,{name:e,color:n}),await this.garage.updateGarage(this.garage.carsPage),document.getElementById("garage").innerHTML=this.view.renderGarage(this.garage._cars,this.page),document.getElementById("update-name").value="",document.getElementById("update-color").value="#ffffff",document.getElementById("update-name").disabled=!0,document.getElementById("update-color").disabled=!0,document.getElementById("update-submit").disabled=!0}));const i=document.getElementById("next-btn"),r=document.getElementById("prev-btn");i.addEventListener("click",(async()=>{switch(this.viewName){case"garage":this.garage.carsPage+=1,await this.garage.updateGarage(this.garage.carsPage),document.getElementById("garage").innerHTML=this.view.renderGarage(this.garage._cars,this.garage.carsPage);break;case"winners":this.winners.winnersPage+=1,await this.winners.updateWinners(),document.getElementById("winners-view").innerHTML=this.view.renderWinners(this.winners.winners)}})),r.addEventListener("click",(async()=>{switch(this.viewName){case"garage":this.garage.carsPage-=1,await this.garage.updateGarage(this.garage.carsPage),document.getElementById("garage").innerHTML=this.view.renderGarage(this.garage._cars,this.garage.carsPage);break;case"winners":this.winners.winnersPage-=1,await this.winners.updateWinners(),document.getElementById("winners-view").innerHTML=this.view.renderWinners(this.winners.winners)}}));const c=async t=>{this.garage.selectedCarId=t.target.id.split("-")[2];const e=await this.garage.getCar(+this.garage.selectedCarId);document.getElementById("update-name").value=e.name,document.getElementById("update-color").value=e.color,document.getElementById("update-name").disabled=!1,document.getElementById("update-color").disabled=!1,document.getElementById("update-submit").disabled=!1},d=async t=>{this.garage.selectedCarId=t.target.id.split("-")[2],await this.garage.deleteCar(+this.garage.selectedCarId),await this.garage.updateGarage(this.garage.carsPage),document.getElementById("garage").innerHTML=this.view.renderGarage(this.garage._cars,this.garage.carsPage)},o=async()=>{const n=((n=100)=>new Array(n).fill(0).map((n=>({name:`${e[Math.floor(Math.random()*e.length)]} ${t[Math.floor(Math.random()*t.length)]}`,color:a()}))))();await Promise.all(n.map((async t=>this.garage.createCar(t)))),await this.garage.updateGarage(this.garage.carsPage),document.getElementById("garage").innerHTML=this.view.renderGarage(this.garage._cars,this.garage.carsPage)},g=async t=>{t.target.disabled=!0;const e=await this.garage.race(this.garage.startDriving.bind(this.garage));await this.winners.saveWinners(e);const n=document.getElementById("message");n.innerHTML=`${e.name} went first with time ${e.time}s!`,n.classList.remove("hide"),document.getElementById("reset").disabled=!1},l=async t=>{t.target.disabled=!0,this.garage._cars.map((({id:t})=>this.garage.stopDriving(t))),document.getElementById("message").classList.add("hide"),document.getElementById("race").disabled=!1},h=async()=>{const t=document.getElementById("garage-view"),e=document.getElementById("winners-view");await this.garage.updateGarage(this.garage.carsPage),this.viewName="garage",t.classList.remove("hide"),e.classList.add("hide")},u=async()=>{const t=document.getElementById("garage-view"),e=document.getElementById("winners-view");await this.winners.updateWinners(),this.viewName="winners",e.innerHTML=this.view.renderWinners(this.winners.winners),t.classList.add("hide"),e.classList.remove("hide")};document.addEventListener("click",(async t=>{if(t.target.classList.contains("garage-menu-button")&&h(),t.target.classList.contains("winners-menu-button")&&u(),t.target.classList.contains("select-button")&&c(t),t.target.classList.contains("remove-button")&&d(t),t.target.classList.contains("generate-button")&&o(),t.target.classList.contains("start-engine-button")){const e=t.target.id.split("-")[2];this.garage.startDriving(+e)}if(t.target.classList.contains("stop-engine-button")){const e=t.target.id.split("-")[2];this.garage.stopDriving(+e)}t.target.classList.contains("race-button")&&g(t),t.target.classList.contains("reset-button")&&l(t),t.target.classList.contains("table-wins")&&(await this.winners.setSortOrder("wins"),document.getElementById("winners-view").innerHTML=this.view.renderWinners(this.winners.winners)),t.target.classList.contains("table-time")&&(await this.winners.setSortOrder("time"),document.getElementById("winners-view").innerHTML=this.view.renderWinners(this.winners.winners))}))}}(r,c,d);o.start()})();